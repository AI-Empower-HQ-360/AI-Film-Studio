version: 1
# AWS Amplify Build Configuration for AI Film Studio Frontend

# Environment variables that will be available during build
# These should be configured in Amplify Console > App Settings > Environment Variables
env:
  variables:
    NODE_VERSION: "18"
    NEXT_PUBLIC_API_URL: "https://api.aifilmstudio.com"
    NEXT_PUBLIC_WS_URL: "wss://api.aifilmstudio.com"
    NEXT_PUBLIC_ENV: "production"
    NEXT_PUBLIC_ENABLE_ANALYTICS: "true"
    NEXT_PUBLIC_ENABLE_VIDEO_GENERATION: "true"
    NEXT_PUBLIC_ENABLE_VOICE_SYNTHESIS: "true"
    NEXT_PUBLIC_ENABLE_LIPSYNC: "true"
    NEXT_PUBLIC_ENABLE_MUSIC_GENERATION: "true"
    NEXT_PUBLIC_ENABLE_PODCAST_VIDEO: "true"
    NEXT_PUBLIC_ENABLE_SUBTITLE_GENERATION: "true"

frontend:
  phases:
    preBuild:
      commands:
        - cd frontend
        - echo "Installing dependencies..."
        - npm ci
        
    build:
      commands:
        - echo "Building Next.js application..."
        - echo "API URL: $NEXT_PUBLIC_API_URL"
        - npm run build
        
  artifacts:
    baseDirectory: frontend/.next
    files:
      - '**/*'
      
  cache:
    paths:
      - frontend/node_modules/**/*
      - frontend/.next/cache/**/*

branches:
  main:
    environment:
      NEXT_PUBLIC_ENV: "production"
      NEXT_PUBLIC_API_URL: "https://api-prod.aifilmstudio.com"
      NEXT_PUBLIC_WS_URL: "wss://api-prod.aifilmstudio.com"
      NEXT_PUBLIC_ENABLE_ANALYTICS: "true"
      
  staging:
    environment:
      NEXT_PUBLIC_ENV: "staging"
      NEXT_PUBLIC_API_URL: "https://api-staging.aifilmstudio.com"
      NEXT_PUBLIC_WS_URL: "wss://api-staging.aifilmstudio.com"
      NEXT_PUBLIC_ENABLE_ANALYTICS: "false"
      
  sandbox:
    environment:
      NEXT_PUBLIC_ENV: "sandbox"
      NEXT_PUBLIC_API_URL: "https://api-sandbox.aifilmstudio.com"
      NEXT_PUBLIC_WS_URL: "wss://api-sandbox.aifilmstudio.com"
      NEXT_PUBLIC_ENABLE_ANALYTICS: "false"
      
  dev:
    environment:
      NEXT_PUBLIC_ENV: "development"
      NEXT_PUBLIC_API_URL: "https://api-dev.aifilmstudio.com"
      NEXT_PUBLIC_WS_URL: "wss://api-dev.aifilmstudio.com"
      NEXT_PUBLIC_ENABLE_ANALYTICS: "false"

# Custom headers for security and performance
customHeaders:
  - pattern: "**/*"
    headers:
      - key: "Strict-Transport-Security"
        value: "max-age=31536000; includeSubDomains"
      - key: "X-Frame-Options"
        value: "SAMEORIGIN"
      - key: "X-Content-Type-Options"
        value: "nosniff"
      - key: "X-XSS-Protection"
        value: "1; mode=block"
      - key: "Referrer-Policy"
        value: "strict-origin-when-cross-origin"
      - key: "Permissions-Policy"
        value: "camera=(), microphone=(), geolocation=()"
        
  - pattern: "*.js"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=31536000, immutable"
        
  - pattern: "*.css"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=31536000, immutable"
        
  - pattern: "*.jpg"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=31536000, immutable"
        
  - pattern: "*.png"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=31536000, immutable"
