version: 1
# AWS Amplify Build Configuration for AI Film Studio Frontend

# Environment variables that will be available during build
# These should be configured in Amplify Console > App Settings > Environment Variables
env:
  variables:
    NODE_VERSION: '18'
    NEXT_PUBLIC_API_URL: 'https://api.aifilmstudio.com'
    NEXT_PUBLIC_WS_URL: 'wss://api.aifilmstudio.com'

frontend:
  phases:
    preBuild:
      commands:
        - cd frontend
        - echo "Installing dependencies..."
        - npm ci
        
    build:
      commands:
        - echo "Building Next.js application..."
        - echo "API URL: $NEXT_PUBLIC_API_URL"
        - npm run build
        
  artifacts:
    baseDirectory: frontend/.next
    files:
      - '**/*'
      
  cache:
    paths:
      - frontend/node_modules/**/*
      - frontend/.next/cache/**/*

# Branch-specific build settings
branches:
  main:
    # Production environment
    environment:
      NEXT_PUBLIC_ENV: production
      NEXT_PUBLIC_API_URL: https://api-prod.aifilmstudio.com
      
  staging:
    # Staging environment
    environment:
      NEXT_PUBLIC_ENV: staging
      NEXT_PUBLIC_API_URL: https://api-staging.aifilmstudio.com
      
  sandbox:
    # Sandbox/QA environment
    environment:
      NEXT_PUBLIC_ENV: sandbox
      NEXT_PUBLIC_API_URL: https://api-sandbox.aifilmstudio.com
      
  dev:
    # Development environment
    environment:
      NEXT_PUBLIC_ENV: development
      NEXT_PUBLIC_API_URL: https://api-dev.aifilmstudio.com

# Custom headers for security and performance
customHeaders:
  - pattern: '**/*'
    headers:
      - key: 'Strict-Transport-Security'
        value: 'max-age=31536000; includeSubDomains'
      - key: 'X-Frame-Options'
        value: 'SAMEORIGIN'
      - key: 'X-Content-Type-Options'
        value: 'nosniff'
      - key: 'X-XSS-Protection'
        value: '1; mode=block'
      - key: 'Referrer-Policy'
        value: 'strict-origin-when-cross-origin'
      - key: 'Permissions-Policy'
        value: 'camera=(), microphone=(), geolocation=()'
        
  - pattern: '*.js'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
        
  - pattern: '*.css'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
        
  - pattern: '*.jpg'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
        
  - pattern: '*.png'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
